<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>菜單內容</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
    <!--   RWD-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--    線上bootstrap 4.0-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!--    iconfont-->
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css'
        integrity='sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ' crossorigin='anonymous'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!--start  此頁增加的css，其他頁暫不用 -->
    <!-- animate CSS -->
    <link rel="stylesheet" href="~/css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="~/css/owl.carousel.min.css">
    <!-- themify CSS -->
    <link rel="stylesheet" href="~/css/themify-icons.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="~/css/flaticon.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="~/css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="~/css/slick.css">
    <link rel="stylesheet" href="~/css/gijgo.min.css">
    <link rel="stylesheet" href="~/css/nice-select.css">
    <link rel="stylesheet" href="~/css/all.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="~/css/style.css">
    <!--Sweet alert-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!--     此網站的css-->
    <link rel="stylesheet" href="~/css/master.css">
    <link rel="stylesheet" href="~/css/product.css">
    <!--end  此頁增加的css，其他頁暫不用 -->
</head>

<body>
    <!--start  navbar-->
    <!--網頁版的nav-->
    <div class="topMenu">
        <div id="navLogo">
            <a href="masterPage.html"><img src="~/img/logo.png" alt=""></a>
        </div>
        <p id="navTitleFont">Restaurant</p>
        <div class="navlinkGroup">
            <a class="a-trigger" href="" id="navTitle">&nbsp;</a>
            <a class="navShopCart a-trigger" href="#"><i class="fas fa-shopping-cart"></i>[{{itemQnt}}]</a>
            <a class="a-trigger" href="#"><i class="fas fa-user"></i>會員</a>
            <a class="a-trigger" href="productClass.html"><i class="fas fa-utensils"></i>菜單</a>
            <a class="a-trigger" href="#"><i class="fas fa-store"></i>簡介</a>
            <button id="rwdMenu" onclick="toggleClass()">
                <span>menu</span>
            </button>
        </div>
    </div>

    <div class="wrapper">
        <!--start 購物車-->
        <div class="container-fluid">
            <div class="shopCart">
                <p></p>
                <div id="shopCartContent">
                    <p class="noItem">購物車內目前沒有商品</p>
                    <shopcart v-bind:item="cartItem" v-for="cartItem in cartItems"></shopcart>
                </div>


                <div class="shopCartFooter row">
                    <p>合計：$ {{sum}}</p>
                    <a href="#">立即結帳</a>
                </div>
            </div>

        </div>
        <!--end 購物車-->
        <!--start content 菜單內容-->
        <!-- food_menu start-->
        <section class="food_menu gray_bg">
            <div class="container">
                <div class="row justify-content-between">
                    <div class="col-lg-3">
                        <div class="section_tittle">
                            <h2>探索饗宴</h2><span>Menu Discovery</span>
                        </div>
                    </div>

                    <!-- Tab種類 -->
                    <div class="col-md-9">
                        <div class="nav nav-tabs food_menu_nav" id="myTab" role="tablist">
                            <a class="active" id="Special-tab" data-toggle="tab" href="#Special" role="tab"
                                aria-controls="Special" aria-selected="false">推薦&nbsp;Special <img
                                    src="~/img/icon/play.svg" alt="play"></a>
                            <a id="Breakfast-tab" data-toggle="tab" href="#Appectizer" role="tab"
                                aria-controls="Breakfast" aria-selected="false">前菜&nbsp;Appetizer<img
                                    src="~/img/icon/play.svg" alt="play"></a>
                            <a id="Launch-tab" data-toggle="tab" href="#Soup" role="tab" aria-controls="Launch"
                                aria-selected="false">湯品&nbsp;Soup<img src="~/img/icon/play.svg" alt="play"></a>
                            <a id="Dinner-tab" data-toggle="tab" href="#Main" role="tab" aria-controls="Dinner"
                                aria-selected="false">主菜&nbsp;Main course<img src="~/img/icon/play.svg" alt="play"> </a>
                            <a id="Sneaks-tab" data-toggle="tab" href="#Dessert" role="tab" aria-controls="Sneaks"
                                aria-selected="false">甜點&nbsp;Dessert<img src="~/img/icon/play.svg" alt="play"></a>
                            <a id="tab6-tab" data-toggle="tab" href="#Beverage" role="tab" aria-controls="tab6"
                                aria-selected="false">飲料&nbsp;Beverage<img src="~/img/icon/play.svg" alt="play"></a>
                        </div>
                    </div>

                    <!-- TabContent -->
                    <div class="col-lg-12">
                        <div class="tab-content" id="myTabContent">
                            <!-- Tab1 -->
                            <div class="tab-pane show active single-member" id="Special" role="tabpanel"
                                aria-labelledby="Special-tab">
                                <div class="row" id="specialMenu">
                                    <product v-bind:item="item" v-for="item in menu"></product>
                                </div>
                            </div>
                            <!-- Tab2 -->
                            <div class="tab-pane single-member" id="Appectizer" role="tabpanel"
                                aria-labelledby="Breakfast-tab">
                            </div>
                            <!-- Tab3 -->
                            <div class="tab-pane single-member" id="Soup" role="tabpanel" aria-labelledby="Launch-tab">
                            </div>
                            <!-- Tab4 -->
                            <div class="tab-pane single-member" id="Main" role="tabpanel" aria-labelledby="Dinner-tab">
                            </div>
                            <!-- Tab5 -->
                            <div class="tab-pane single-member" id="Dessert" role="tabpanel"
                                aria-labelledby="Sneaks-tab">
                            </div>
                            <!-- Tab6 -->
                            <div class="tab-pane single-member" id="tab6" role="tabpanel"
                                aria-labelledby="Breakfast-tab">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- food_menu part end-->
        <!--start-food modal細節-->
        <!--end content-->
        <!--必要! 為了把footer置底用-->
        <div class="push"></div>
    </div>

    <!--start Footer -->
    <footer class="bs-footer">
        <!-- Copyright -->
        <div class="py-3">
            © 2019 Copyright
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Big Champion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <!--社群icon連結-->
            <ul class="social-network social-circle">
                <li><a href="#" class="icoFacebook" title="Facebook"><i class="fab fa-facebook-f"></i></a></li>
                <li><a href="#" class="icoInstagram" title="Instagram"><i class="fab fa-instagram"></i></a></li>
                <li><a href="#" class="icoTwitter" title="Twitter"><i class="fab fa-twitter"></i></a></li>
                <li><a href="#" class="icoYoutube" title="Youtube"><i class="fab fa-youtube"></i></a></li>
            </ul>
        </div>


    </footer>
    <!--end Footer -->


    <!--商品卡片-->
    <script type="text/x-template" id="productCard">
        <div class="col-sm-6 col-lg-6">
        <div class="single_food_item media">
                <img v-bind:src="'.'+item.ProductPhotoS" class="mr-3" alt="...">
                <div class="media-body align-self-center">
                    <h3>{{item.ProductName}}</h3>
                    <p>{{item.ProductIntroduction}}</p>
                    <h5>$ {{item.UnitPrice}}</h5>
                    <!--按鈕集合-->
                    <ul class="footItemIconGruop">
                        <li>
                            <span class="seePicBtn seeFoodDetail">
                                <i class="fas fa-search"></i>
                            </span>
                        </li>
                        <li>
                            <a @click="$root.addCart(item.ProductName, item.UnitPrice, 1,item.ProductPhotoS,)" class="addCartBtn" href="#">
                                <i class="fas fa-cart-plus"></i>
                            </a>
                        </li>
                        <li>
                            <a class="addLoveBtn" href="#">
                                <i class="fas fa-heart"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </script>

    <!--購物車商品-->
    <script type="text/x-template" id="cartItem">
    <transition leave-active-class="animated bounceOutRight">
        <!--購物內容 1-->
        <div v-bind:id="item.ProductName" class="shopCartItem">
            <a href="#">
                <img v-bind:src="'.'+item.Photo"/>
                <div>
                    <p>{{item.ProductName}}</p>
                    <span>$ {{item.UnitPrice}}</span>
                </div>
            </a>
            <span class="ItemQuantity">{{item.Quantity}} 份</span>
            <button @click="$root.deleteItem(item.ProductName)" class="DelBtn btn btn-outline-secondary"><span class="fas fa-trash-alt"></span></button>
        </div>
    </transition>
    </script>

    <script>
        Vue.component('product', {
            props: ['item'],
            template: '#productCard'
        });

        Vue.component("shopcart", {
            props: ["item"],
            template: "#cartItem"
        });

        var productUrl = "http://localhost/exam/api/product/ProductInfo.php";
        var addUrl = "http://localhost/exam/api/shopcart/create.php";
        var shopcartUrl = "http://localhost/exam/api/shopcart/read.php";
        var deleteUrl = "http://localhost/exam/api/shopcart/delete.php";

        var productCard = new Vue({
            el: "#specialMenu",
            data: {
                menu: ""
            },
            methods: {
                addCart: function (Name, Price, Amount, Image) {
                    var newItem = { ProductName: Name, UnitPrice: Price, Quantity: Amount, Photo: Image };
                    $.ajax({
                        type: "POST",
                        url: addUrl,
                        data: JSON.stringify(newItem),
                        dataType: "json",
                    })

                    swal("加入購物車成功", {
                        icon: "success",
                        buttons: false,
                        timer: 1000,
                    });

                    $.ajax({
                        type: "POST",
                        url: shopcartUrl,
                        success: function (response) {
                            shopCartContent.cartItems = response;
                            navbar.itemQnt = Object.keys(response).length;
                            shopcartFooter.sum = 0;
                            $.each(response, function (index, value) {
                                shopcartFooter.sum += value.UnitPrice * value.Quantity;
                            })
                        }
                    });
                },
            },
        })

        $.ajax({
            type: "POST",
            url: productUrl,
            success: function (response) {
                productCard.menu = response["products"];
            }
        });

        var shopCartContent = new Vue({
            el: "#shopCartContent",
            data: {
                cartItems: "",
            },
            methods: {
                deleteItem(name) {
                    $.ajax({
                        type: "POST",
                        url: deleteUrl,
                        data: JSON.stringify({ ProductName: name }),
                        dataType: "json",
                        success: function (response) {
                            console.log(response);
                        }
                    });
                    var idx = 0;
                    var total = 0;
                    $.each(this.cartItems, function (index, value) {
                        if (value.ProductName == name) {
                            total = value.UnitPrice * value.Quantity;
                            return idx = index;
                        }
                    });

                    this.cartItems.splice(idx, 1);
                    navbar.itemQnt -= 1;
                    shopcartFooter.sum -= total;
                }
            },
        })

        var navbar = new Vue({
            el: ".navlinkGroup",
            data: {
                itemQnt: 0
            }
        });

        var shopcartFooter = new Vue({
            el: ".shopCartFooter",
            data: {
                sum: 0
            }
        });

        $.ajax({
            type: "POST",
            url: shopcartUrl,
            success: function (response) {
                shopCartContent.cartItems = response;
                navbar.itemQnt = Object.keys(response).length;
                $.each(response, function (index, value) {
                    shopcartFooter.sum += value.UnitPrice * value.Quantity;
                })
            }
        });
    </script>
    <!-- jquery plugins here-->
    <!-- popper js -->
    <script src="~/js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="~/js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="~/js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="~/js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="~/js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="~/js/owl.carousel.min.js"></script>
    <!-- swiper js -->
    <script src="~/js/slick.min.js"></script>
    <script src="~/js/gijgo.min.js"></script>
    <script src="~/js/jquery.nice-select.min.js"></script>
    <!-- custom js -->
    <script src="~/js/custom.js"></script>

    <!--此網站的js-->
    <script src="~/js/masterPage.js"></script>
</body>

</html>